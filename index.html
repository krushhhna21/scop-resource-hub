<!doctype html>
<html lang="en">
<head>
  <meta name="google-client-id" content="614874768179-jeif5hfmlgs7f67mqct37t42soq7qhdg.apps.googleusercontent.com">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pharm D Mates</title>
  <link rel="stylesheet" href="assets/css/styles.css?v=20251109e">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!-- Favicons -->
  <link rel="icon" type="image/jpeg" href="assets/images/logo.jpeg?v=20251109">
  <link rel="apple-touch-icon" href="assets/images/logo.jpeg?v=20251109">
  <link rel="shortcut icon" href="assets/images/logo.jpeg?v=20251109">
  <meta name="description" content="Pharm D Mates â€” Resource Hub for pharmacy students and faculty">
  <meta name="api-base" content="/api/index.php">
  <script>
    // Force HTTPS in production to satisfy Google Identity origin checks
    (function(){
      var host = window.location.hostname;
      if(host === 'pharmd.xo.je' && window.location.protocol !== 'https:'){
        try { window.location.href = 'https://' + host + window.location.pathname + window.location.search + window.location.hash; } catch(_) {}
      }
    })();
  </script>
  <meta name="api-base" content="/api/index.php">
</head>
<body>
  <!-- Simplified Auth Prompt: redirect instead of inline Google button -->
  <div id="authPanel" style="display:none;position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);">
    <div style="max-width:480px;margin:10vh auto;background:#fff;border-radius:18px;box-shadow:0 24px 72px -12px rgba(31,6,43,.35);padding:1.5rem 1.75rem;">
      <div style="display:flex;align-items:center;gap:1rem;">
  <img src="assets/images/logo.jpeg" alt="Logo" style="width:56px;height:56px;border-radius:14px;object-fit:cover;" />
        <div>
          <h2 style="margin:0;font-size:1.35rem;letter-spacing:-.5px;">Access Required</h2>
          <div class="muted" style="font-size:.85rem;">You need to login to view the resources.</div>
        </div>
        

      </div>
      <div style="margin-top:1.25rem;display:flex;flex-direction:column;gap:.85rem;">
        <a href="login.html" class="btn primary" style="display:inline-flex;align-items:center;justify-content:center;gap:.5rem;font-weight:600;">
          <span class="material-icons" style="font-size:20px;">login</span>
          Go to Login Page
        </a>
        <p class="muted" style="font-size:.75rem;line-height:1.3;margin:0;">Use your college Gmail on the next page. After first login, an admin must approve your account before full access.</p>
      </div>
    </div>
  </div>
  <div class="menu-tab" role="navigation">
    <button class="menu-button" id="menuButton" aria-label="Menu" title="Open menu">
      <span class="material-icons">more_vert</span>
    </button>
    <div class="menu-content" id="menuContent" role="menu">
      <nav class="menu-grid">
        <a href="#" class="menu-item" data-library="home" role="menuitem">
          <span class="material-icons">home</span>
          Home
        </a>
        <a href="#" class="menu-item" data-library="books" role="menuitem">
          <span class="material-icons">menu_book</span>
          Books
        </a>
        <a href="#" class="menu-item" data-library="journals" role="menuitem">
          <span class="material-icons">article</span>
          Journals
        </a>
        <a href="#" class="menu-item" data-library="publications" role="menuitem">
          <span class="material-icons">description</span>
          Publications
        </a>
        <a href="#" class="menu-item" data-library="directory" role="menuitem">
          <span class="material-icons">people</span>
          Directory
        </a>
        <a href="#" class="menu-item" data-library="vacancies" role="menuitem">
          <span class="material-icons">work_outline</span>
          Vacancies
        </a>
        <a href="#" class="menu-item" data-library="career" role="menuitem">
          <span class="material-icons">work</span>
          Career
        </a>
  <a href="#" class="menu-item" data-library="questions" role="menuitem">
          <span class="material-icons">quiz</span>
          Case Studies
        </a>
        <a href="#" class="menu-item" data-library="important-questions" role="menuitem">
          <span class="material-icons">priority_high</span>
          Important Questions
        </a>
        <a href="#" class="menu-item" data-library="resources" role="menuitem">
          <span class="material-icons">folder</span>
          Resources
        </a>
        <a href="#" id="logoutLink" class="menu-item" role="menuitem" style="display:none;">
          <span class="material-icons">logout</span>
          Sign Out
        </a>
        <a href="admin-login.html" class="menu-item" role="menuitem">
          <span class="material-icons">admin_panel_settings</span>
          Admin Portal
        </a>
      </nav>
    </div>
  </div>

  <div class="hero-section">
    <div class="container">
      <header class="header">
        <div class="brand">
          <div class="brand-logo" aria-hidden="true">
            <img src="assets/images/logo.jpeg" alt="Logo">
          </div>
          <div>
            <h1>Pharm D Mates</h1>
            
          </div>
        </div>
          <div class="actions">
          <!-- Removed Sign In, Admin, Print buttons per request -->
        </div>
      </header>
      
      <div class="hero-content">
        <div class="hero-slideshow" aria-live="polite">
          <!-- Home Slide -->
          <div class="hero-slide active">
            <div class="hero-glass" role="group" aria-label="Overview slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Your Pharm D Coâ€‘Pilot</h2>
                  <p class="hero-sub">Discover curated books, journals, publications, and question banks â€” all in one hub.</p>
                  <div class="hero-cta">
                    <a href="#type=books" class="btn">Explore Books</a>
                    <a href="#type=questions" class="btn ghost">Practice Questions</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Glassmorphic UI</div>
                  <div class="chip">Fast Search</div>
                  <div class="chip">Mobile Friendly</div>
                  <div class="hero-stat"><div class="num">500+</div><div class="label">Resources</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Books -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Books slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Books Library</h2>
                  <p class="hero-sub">Recommended textbooks and references organized by year and subject.</p>
                  <div class="hero-cta">
                    <a href="#type=books" class="btn">Open Books</a>
                    <a href="#type=resources" class="btn ghost">All Resources</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">PDF & Links</div>
                  <div class="chip">Subjectâ€‘wise</div>
                  <div class="hero-stat"><div class="num">6</div><div class="label">Years</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Journals -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Journals slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Pharmacy Journals</h2>
                  <p class="hero-sub">Stay updated with latest research and peerâ€‘reviewed articles.</p>
                  <div class="hero-cta">
                    <a href="#type=journals" class="btn">Browse Journals</a>
                    <a href="#type=publications" class="btn ghost">See Publications</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Peerâ€‘Reviewed</div>
                  <div class="chip">Curated Picks</div>
                  <div class="hero-stat"><div class="num">+New</div><div class="label">Updates</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Publications -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Publications slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Publications</h2>
                  <p class="hero-sub">Research papers and academic publications from the community.</p>
                  <div class="hero-cta">
                    <a href="#type=publications" class="btn">Open Publications</a>
                    <a href="#type=resources" class="btn ghost">General Resources</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Abstracts</div>
                  <div class="chip">Downloads</div>
                  <div class="hero-stat"><div class="num">Top</div><div class="label">Papers</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Resources -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Resources slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">General Resources</h2>
                  <p class="hero-sub">Notes, forms, and extra materials to support your learning.</p>
                  <div class="hero-cta">
                    <a href="#type=resources" class="btn">Find Resources</a>
                    <a href="#type=books" class="btn ghost">Books</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Forms</div>
                  <div class="chip">Notes</div>
                  <div class="hero-stat"><div class="num">New</div><div class="label">Adds</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Previous Year Questions -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Case Studies slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Case Studies</h2>
                  <p class="hero-sub">Practice with authentic papers â€” filter by year and subject.</p>
                  <div class="hero-cta">
                    <a href="#type=questions" class="btn">Open Case Studies</a>
                    <a href="#type=important-questions" class="btn ghost">Important</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Yearâ€‘wise</div>
                  <div class="chip">Subjectâ€‘wise</div>
                  <div class="hero-stat"><div class="num">+Prep</div><div class="label">Focus</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Important Questions -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Important Questions slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Important Questions</h2>
                  <p class="hero-sub">Curated mustâ€‘know topics and highâ€‘yield questions.</p>
                  <div class="hero-cta">
                    <a href="#type=important-questions" class="btn">View Important</a>
                    <a href="#type=questions" class="btn ghost">All Case Studies</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Highâ€‘Yield</div>
                  <div class="chip">Examâ€‘Ready</div>
                  <div class="hero-stat"><div class="num">Top</div><div class="label">Picks</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Directory -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Directory slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Directory</h2>
                  <p class="hero-sub">Find students and profiles; connect with peers and mentors.</p>
                  <div class="hero-cta">
                    <a href="#type=directory" class="btn">Open Directory</a>
                    <a href="#type=resources" class="btn ghost">Resources</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Profiles</div>
                  <div class="chip">Contacts</div>
                  <div class="hero-stat"><div class="num">Peer</div><div class="label">Network</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Vacancies -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Vacancies slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Vacancies</h2>
                  <p class="hero-sub">Jobs, internships, and referrals â€” updated regularly.</p>
                  <div class="hero-cta">
                    <a href="#type=vacancies" class="btn">See Vacancies</a>
                    <a href="#type=career" class="btn ghost">Career</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Internships</div>
                  <div class="chip">Jobs</div>
                  <div class="hero-stat"><div class="num">New</div><div class="label">Openings</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Career -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Career slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Career</h2>
                  <p class="hero-sub">Guides, opportunities, and growth paths for Pharm D professionals.</p>
                  <div class="hero-cta">
                    <a href="#type=career" class="btn">Explore Career</a>
                    <a href="#type=vacancies" class="btn ghost">Openings</a>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">Guides</div>
                  <div class="chip">Roadmaps</div>
                  <div class="hero-stat"><div class="num">Next</div><div class="label">Steps</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Assistant -->
          <div class="hero-slide">
            <div class="hero-glass" role="group" aria-label="Assistant slide">
              <div class="hero-slide-grid">
                <div class="hero-copy">
                  <h2 class="hero-title">Ask the Assistant</h2>
                  <p class="hero-sub">Get quick help locating notes and resources using the floating assistant.</p>
                  <div class="hero-cta">
                    <a href="#type=resources" class="btn">Find Resources</a>
                    <button class="btn ghost" type="button" onclick="window.SCOP_CHATBOT && SCOP_CHATBOT.open()">Open Assistant</button>
                  </div>
                </div>
                <div class="hero-side">
                  <div class="chip">AI Help</div>
                  <div class="chip">Context Aware</div>
                  <div class="hero-stat"><div class="num">4s</div><div class="label">Rotate</div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Persistent Assistant pill directly below slideshow -->
      <div class="assistant-below-hero" style="display:flex;justify-content:center;margin:12px 0 0;">
        <button id="assistantChatButton" type="button" aria-label="Chat With Us"
          onclick="openChatCentered()"
          style="display:inline-flex;align-items:center;gap:10px;padding:10px 26px;border:0;border-radius:18px;font-weight:600;font-size:14px;letter-spacing:.25px;color:#fff;background:linear-gradient(90deg,#3b82f6,#06b6d4);box-shadow:0 6px 18px -4px rgba(0,0,0,.25);cursor:pointer;position:relative;">
          <span class="assistant-icon" style="width:22px;height:22px;position:relative;display:inline-block;">
            <span style="position:absolute;top:50%;left:50%;width:11px;height:11px;background:#fff;border-radius:50%;transform:translate(-50%,-50%);"></span>
            <span style="position:absolute;top:36%;left:70%;width:8px;height:8px;background:#fff;border-radius:50%;"></span>
          </span>
          <span>Chat With Us</span>
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <section class="features-section">
      <div class="features-grid">
        <div class="feature-card">
          <h3>ðŸ“š Comprehensive Resources</h3>
          <p>Access a wide range of study materials, lecture notes, and reference documents.</p>
        </div>
        <div class="feature-card">
          <h3>ðŸŽ“ Academic Excellence</h3>
          <p>Supporting pharmacy education with quality resources and materials.</p>
        </div>
        <div class="feature-card">
          <h3>ðŸ“± Easy Access</h3>
          <p>Access your study materials anytime, anywhere on any device.</p>
        </div>
      </div>
    </section>

    <div class="library-sections">
      <main class="card library-section active" id="home-library">
        <div class="section-header">
          <h2>Pharm D Mates</h2>
          <p class="muted">Recent notes and important resources</p>
        </div>
        <div id="home-content" class="library-content">
          <!-- Content will be loaded dynamically -->
        </div>
      </main>

      <main class="card library-section" id="books-library" style="display: none;">
        <div class="section-header">
          <h2>Books Library</h2>
          <p class="muted">Access recommended textbooks and reference materials</p>
        </div>
        <div id="books-content" class="library-content">
          <div id="booksGrid" class="grid"></div>
        </div>
      </main>

      <main class="card library-section" id="journals-library" style="display: none;">
        <div class="section-header">
          <h2>Pharmacy Journals</h2>
          <p class="muted">Access to latest pharmaceutical research and journals</p>
        </div>
        <div id="journals-content" class="library-content">
          <div id="journalsGrid" class="grid"></div>
        </div>
      </main>

      <main class="card library-section" id="publications-library" style="display: none;">
        <div class="section-header">
          <h2>Publications</h2>
          <p class="muted">Research papers and academic publications</p>
        </div>
        <div id="publications-content" class="library-content">
          <div id="publicationsGrid" class="grid"></div>
        </div>
      </main>

      <main class="card library-section" id="career-library" style="display: none;">
        <div class="section-header">
          <h2>Career Opportunities</h2>
          <p class="muted">Job openings and career development resources</p>
        </div>
        <div id="career-content" class="library-content">
          <div id="careerGrid" class="grid"></div>
        </div>
      </main>

  <main class="card library-section" id="questions-library" style="display: none;">
        <div class="section-header">
          <h2>Case Studies</h2>
          <p class="muted">Explore curated case studies and practice materials</p>
        </div>
  <div id="questions-content" class="library-content">
          <div class="section-header">
            <h2>Select System</h2>
            <p class="muted">Pick a body system to view case studies</p>
          </div>
          <div id="questionsYearGrid" class="grid"></div>
        </div>
      </main>

      <main class="card library-section" id="important-questions-library" style="display: none;">
        <div class="section-header">
          <h2>Important Questions</h2>
          <p class="muted">Curated important questions for exam preparation</p>
        </div>
        <div id="important-questions-content" class="library-content">
        </div>
      </main>

      <main class="card library-section" id="resources-library" style="display: none;">
        <div class="section-header">
          <h2>General Resources</h2>
          <p class="muted">Additional study materials and learning resources</p>
        </div>
        <div id="resources-content" class="library-content">
          <div id="resourcesGrid" class="grid"></div>
        </div>
      </main>

      <main class="card library-section" id="directory-library" style="display:none;">
        <div class="section-header">
          <h2>Directory</h2>
          <p class="muted">Find students and profiles</p>
        </div>
        <div id="directory-content" class="library-content"></div>
      </main>

      <main class="card library-section" id="vacancies-library" style="display:none;">
        <div class="section-header">
          <h2>Vacancies</h2>
          <p class="muted">Jobs, internships, and referrals</p>
        </div>
        <div id="vacancies-content" class="library-content"></div>
      </main>

      
    </div>

    <footer>
  Â© <span id="year"></span> Pharm D Mates â€¢ Built for students and faculty VertexHub
    </footer>
  </div>

  <script src="assets/js/app.fixed.js?v=20251109c"></script>
  <script src="assets/js/auth.js?v=20251107"></script>
  <!-- Pre-stub to block fallback race if main script loads slowly -->
  <script>
    // Early stub with queued open support so "Chat With Us" can be clicked before main script loads
    if(!window.SCOP_CHATBOT){
      window.SCOP_CHATBOT = {
        __earlyStub: true,
        open: function(){ window.__CHATBOT_CENTER_OPEN_PENDING = true; },
        send: function(msg){ window.__CHATBOT_CENTER_OPEN_PENDING = true; window.__CHATBOT_QUEUED_MESSAGE = msg; },
        debug: function(){ return { earlyStub: true, queuedOpen: !!window.__CHATBOT_CENTER_OPEN_PENDING }; }
      };
    }
    // Independent centered modal opener (works even if chatbot.js not ready yet)
    window.openChatCentered = function(){
      try { console.log('[center-modal] openChatCentered invoked'); } catch(_){ }
      // If main chatbot provides centered open, use it
      if (window.SCOP_CHATBOT && typeof SCOP_CHATBOT.open === 'function' && !SCOP_CHATBOT.__earlyStub) {
        return SCOP_CHATBOT.open();
      }
      // Build fallback centered overlay if not present
      var existing = document.getElementById('assistantModalOverlay');
      if (!existing){
        var ov = document.createElement('div');
        ov.id = 'assistantModalOverlay';
        ov.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:100000;';
  var panel = document.createElement('div');
  panel.id='assistantModalPanel';
  panel.style.cssText='width:640px;max-width:96vw;max-height:80vh;display:flex;flex-direction:column;background:#0f0f10;color:#e5e7eb;border-radius:20px;box-shadow:0 24px 64px -12px rgba(0,0,0,.55);overflow:hidden;';
  panel.innerHTML = '<div style="display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,#0b0b0c,#18181b);color:#fff;font-weight:600">Assistant <button type="button" id="assistantClose" style="background:transparent;border:0;color:#fff;font-size:20px;cursor:pointer;line-height:1">Ã—</button></div><div id="assistantBody" style="flex:1;overflow:auto;padding:14px 16px;font-size:14px;color:#e5e7eb"></div><div style="border-top:1px solid #262626;display:flex;background:#0b0b0c"><textarea id="assistantInput" placeholder="Ask me anything..." style="flex:1;border:0;padding:10px;resize:none;height:54px;background:#0b0b0c;color:#e5e7eb"></textarea><button id="assistantSend" style="width:80px;border:0;background:#0ea5e9;color:#fff;font-weight:600">Send</button></div>';
        ov.appendChild(panel);
        document.body.appendChild(ov);
        ov.addEventListener('click', function(e){ if(e.target===ov){ ov.remove(); }});
        panel.querySelector('#assistantClose').addEventListener('click', function(){ ov.remove(); });
        panel.querySelector('#assistantSend').addEventListener('click', function(){
          var val = panel.querySelector('#assistantInput').value.trim();
          if(!val) return; panel.querySelector('#assistantInput').value='';
          appendFallbackMessage('user', val);
          appendFallbackMessage('bot', '...');
          if(window.SCOP_CHATBOT && typeof SCOP_CHATBOT.send==='function' && !SCOP_CHATBOT.__earlyStub){
            SCOP_CHATBOT.send(val);
            // Replace the three-dot bubble with SCOP_CHATBOT response later handled by main script; leave as is.
          } else {
            // Direct fetch fallback
            fetch('api/index.php?action=chat', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:val})})
              .then(r=>r.json().catch(()=>({reply:'(raw) '+r.status})))
              .then(d=>{ replaceLastBot(d.reply||d.error||'(no reply)'); })
              .catch(err=>{ replaceLastBot('Network error: '+err.message); });
          }
        });
        function appendFallbackMessage(who, text){
          var body = panel.querySelector('#assistantBody');
          var row = document.createElement('div');
          row.style.marginBottom='8px';
          var bubble = document.createElement('span');
          bubble.style.cssText='display:inline-block;padding:8px 10px;border-radius:12px;max-width:85%';
          bubble.textContent=text;
          if(who==='user'){ row.style.textAlign='right'; bubble.style.background='#0ea5e9'; bubble.style.color='#fff'; }
          else { bubble.style.background='#1f2937'; bubble.style.color='#e5e7eb'; }
          row.appendChild(bubble); body.appendChild(row); body.scrollTop=body.scrollHeight;
        }
        function replaceLastBot(text){ var body = panel.querySelector('#assistantBody'); var bots=[...body.querySelectorAll('div')].filter(d=>d.style.textAlign!=='right'); if(bots.length){ var last=bots[bots.length-1].querySelector('span'); if(last) last.textContent=text; } }
      } else {
        existing.style.display='flex';
      }
    };
  </script>
  <!-- Chatbot primary script (cache-bust with new version) -->
  <script src="assets/js/chatbot.js?v=20251109d" id="chatbotMain"></script>
  <!-- Fallback injector: if chatbot script failed or was blocked, build a minimal button -->
  <script>
    (function(){
      const start = Date.now();
      function injectFallback(){
        // Only skip if main chatbot API is live AND a FAB exists in DOM
        const apiReady = !!(window.SCOP_CHATBOT && typeof window.SCOP_CHATBOT.open === 'function');
        const fabExists = !!document.querySelector('.chatbot-fab');
        if(apiReady && fabExists){ console.log('[chatbot-fallback] primary loaded; no fallback needed'); return; }
        console.warn('[chatbot-fallback] SCOP_CHATBOT missing after', Date.now()-start,'ms; injecting minimal button');
        var btn = document.createElement('button');
        btn.className = 'chatbot-fab';
        btn.innerHTML = '<svg viewBox="0 0 64 64" class="chatbot-bot" aria-hidden="true" focusable="false"><g class="bot"><rect x="12" y="20" width="40" height="28" rx="8" fill="currentColor"/><circle cx="26" cy="34" r="5" class="eye eye-left" fill="#0a2540"/><circle cx="38" cy="34" r="5" class="eye eye-right" fill="#0a2540"/><rect x="24" y="38" width="16" height="4" rx="2" class="mouth" fill="#ffffff"/><rect x="30" y="10" width="4" height="10" rx="2" fill="currentColor"/><circle cx="32" cy="8" r="4" class="antenna" fill="currentColor"/></g></svg>';
        btn.onclick = function(){
          var panel = document.getElementById('chatbotFallbackPanel');
          if(!panel){
            panel = document.createElement('div');
            panel.id = 'chatbotFallbackPanel';
            panel.className = 'chatbot-panel';
            panel.innerHTML = '<div class="chatbot-header">Assistant</div><div class="chatbot-body" id="fbChatBody"></div><form class="chatbot-input" id="fbChatForm"><textarea id="fbChatInput" placeholder="Ask..."></textarea><button type="submit">Send</button></form>';
            document.body.appendChild(panel);
            panel.querySelector('#fbChatForm').addEventListener('submit', async function(e){
              e.preventDefault();
              const val = panel.querySelector('#fbChatInput').value.trim(); if(!val) return;
              const body = panel.querySelector('#fbChatBody');
              body.innerHTML += '<div style="text-align:right;margin-bottom:6px"><span style="display:inline-block;background:#a855f7;color:#fff;padding:6px 8px;border-radius:12px">'+val.replace(/</g,'&lt;')+'</span></div>';
              panel.querySelector('#fbChatInput').value='';
              body.innerHTML += '<div style="margin-bottom:6px"><span style="display:inline-block;background:#f1f5f9;color:#0f172a;padding:6px 8px;border-radius:12px">...</span></div>';
              body.scrollTop = body.scrollHeight;
              try { btn.classList.add('speaking'); } catch(_) {}
              try {
                const resp = await fetch('api/index.php?action=chat', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:val})});
                let txt; try { const j = await resp.json(); txt = j.reply || j.error || JSON.stringify(j); } catch(_){ txt = await resp.text(); }
                body.lastElementChild.querySelector('span').textContent = txt.slice(0,800);
                body.scrollTop = body.scrollHeight;
              } catch(err){ body.lastElementChild.querySelector('span').textContent = 'Network error: '+err.message; }
              finally { try { btn.classList.remove('speaking'); } catch(_) {} }
            });
          } else {
            panel.style.display = panel.style.display==='none' ? 'flex' : 'none';
          }
        };
        document.body.appendChild(btn);
        // Pop cloud tip near fallback button
        var tip = document.createElement('div');
        tip.textContent = 'Hey! Your assistant is here â€” can I help?';
        tip.style.cssText = 'position:fixed;right:100px;bottom:30px;background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.12);padding:.55rem .75rem;font-size:.82rem;z-index:100003;transform-origin:bottom right;opacity:0;';
        document.body.appendChild(tip);
        requestAnimationFrame(function(){ tip.style.transition='opacity .35s ease, transform .35s ease'; tip.style.opacity='1'; tip.style.transform='translateY(0)'; });
        setTimeout(function(){ tip.style.opacity='0'; tip.style.transform='translateY(-6px)'; setTimeout(function(){ if(tip.parentNode) tip.parentNode.removeChild(tip); }, 400); }, 3600);
      }
      // Attempt fallback after delays
      setTimeout(injectFallback, 1800);
      setTimeout(injectFallback, 4000);
    })();
  </script>
</body>
</html>
